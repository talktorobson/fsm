{
    email talktorobson@gmail.com
}

# ============================================================
# STAGING ENVIRONMENT - Single VPS (135.181.96.93)
# ============================================================

# Camunda Operate - dedicated subdomain (avoids base href conflicts)
operate.goexec.de {
    reverse_proxy operate:8080
}

# Camunda Tasklist - dedicated subdomain
tasklist.goexec.de {
    reverse_proxy tasklist:8080
}

# Staging domain (primary) + legacy domains
staging.goexec.de, www.goexec.de, goexec.de {
    encode gzip
    header X-Environment "staging"

    # API
    handle /api/* {
        reverse_proxy api:3000
    }

    # Mobile app assets
    handle /_expo/* {
        root * /srv/mobile
        try_files {path} =404
        file_server
    }

    # Mobile app
    handle_path /mobile/* {
        root * /srv/mobile
        try_files {path} /index.html
        file_server
    }

    # Web SPA
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}

# IP fallback - Self-signed certificate
135.181.96.93 {
    tls internal
    encode gzip
    header X-Environment "staging"

    handle /api/* {
        reverse_proxy api:3000
    }

    handle /_expo/* {
        root * /srv/mobile
        try_files {path} =404
        file_server
    }

    handle_path /mobile/* {
        root * /srv/mobile
        try_files {path} /index.html
        file_server
    }

    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}
